{% extends 'layouts/blank.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %} 

<article class="card mb-8 card rounded-2xl md:drop-shadow-2xl shadow-black w-full bg-white">
    <div class="flex items-center justify-between px-4 h-14">
        <h3 class="text-lg font-bold w-[50%] truncate">{{ post.title }}</h3>
        <div class="text-sm text-gray-500">flickr @ <a href="" class="hover:underline" target="blank">{{ post.artist }}</a></div>
    </div>
    <figure>
        <p><img class="w-full" src="{{ post.image }}"></p>
    </figure>
    <div class="p-2 pb-2">
        <p class="flex items-center gap-1 mb-4" >
            <a href="{% url 'userprofile' post.author.username %}"><img class="w-8 h-8 object-cover rounded-full" src="{{ post.author.profile.avatar }}"></a>
            <a class="font-bold hover:underline" href="{% url 'userprofile' post.author.username %}"><span>{{ post.author.profile.name }}</span></a>
            <a class="text-sm text-gray-400" href="{% url 'userprofile' post.author.username %}"><span>@{{ post.author.username|title }}</span></a>
            <span class="text-sm text-gray-400">| created {{ post.created }}</span>
        </p>
        <h1 class="text-5xl mb-10 px-4 font1">{{ post.body }}</h1>
        <div class="flex items-center gap-2 text-sm mb-5">
            {% for tag in post.tags.all %}
            <a class="bg-gray-200 rounded-full px-3 py-1 hover:bg-gray-500 hover:text-white" href="{% url 'category' tag.slug %}">{{ tag.name }}</a>
            {% endfor %}
        </div>
        <div class="flex items-center justify-between text-sm px-2">
            <a class="font-bold hover:underline" href="">
                Comments
                <span class="font-light text-gray-500 ml-2">{{ post.comments.all.count }}</span>
            </a>
            <div class="flex items-center gap-4 [&>a:hover]:underline">
                <div class="flex items-center gap-1">
                    <img class="w-5 -mt-1" src="{% static 'images/fireheart_red.svg' %}">
                    1
                </div>
                <a href="">Like</a>
                {% if request.user == post.author %}
                    <a href="{% url 'edit_post' post.pk %}">Edit</a>
                    <a href="{% url 'delete_post' post.pk %}">Delete</a>
                {% endif %}
            </div>
        </div>
    </div>
</article>

<!-- Comments form -->
<div class="card !pb-0 mb-8 -mt-3 rounded-2xl md:drop-shadow-2xl shadow-black w-full bg-white">
    <form method="post" class="flex items-center p-4 gap-2 w-full" autocomplete="off">
    {% csrf_token %}
    {{ form.body.errors }}
    <input 
        type="text" 
        name="body" 
        placeholder="Add comment..." 
        class="flex-1 bg-blue-100 text-lg p-2 rounded-md" 
        value="{{ form.body.value|default:'' }}"
    >
    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-md shadow-md">
        Submit
    </button>
</form>

</div>

<!-- Comments display -->
<div class="mb-20">
    <div id="tabs" class="ml-4 flex gap-2 mb-4">  <!-- Increased gap to 2 -->
        <div class="card-container">
            <a class="tab selected rounded-lg border border-gray-200 bg-red-300 shadow-sm px-4 py-2 text-sm font-medium text-gray-900 hover:bg-blue-50 transition-colors">
                Newest First
            </a>
        </div>
        <div class="card-container">
            <a class="tab rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors">
                Top Comments
            </a>
        </div>
    </div>

    <div class="card rounded-2xl md:drop-shadow-2xl shadow-black w-full bg-white" id="tab-contents">
            {% for comment in post.comments.all %}
                {% include 'a_posts/comments.html' %}
            {% endfor %}
    </div>
</div>

{% endblock %}